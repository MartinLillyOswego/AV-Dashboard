<!doctype html>
<html>
	<head>
		<title>Dashboard</title>
		<link rel="stylesheet" href="static/dashboard.css">
		<link rel="stylesheet" href="static/speed.css">
		<link href="https://fonts.cdnfonts.com/css/seven-segment" rel="stylesheet">
	</head>

	<body style="font-family: Trebuchet MS">
		<div id="main_div">

            <!-- Top Bar -->
			<div id="top_bar">
				<h1 id="battery_percent_and_temp" style="font-family:Seven Segment; color:#acadad; font-size: 24px;">0% 0&degF</h1>
				<img id="battery_img" src="static/icons/battery0.png">

                <!-- open the tuning menu -->
                <form id="config_button" action="/open_config">
                <input name="config" value="none" type="hidden">
                <button style="width: 60%; color:#858F94;" type="submit">
                    <img src="static/icons/gear.png" style="width: 100%;"></button></form>
			</div>

            <!-- Main Dashboard stuff -->
			<div id="main">

                <!-- Speed Graphic -->
				<div id="speed_zone" style="width: 35%;">
					<div id="speedometer-container-1" style="width: 100%;">
						<div id="speedometer-container-2" style="width: 100%;">
							<div id="speedometer">
								<div id="scales-container"></div>
								<div id="center-hide"></div>
								<div id="center"></div>
								<div id="bottom-hide"></div>
								<div id="arrow-container">
									<div id="arrow-wrapper">
										<div id="arrow"></div>
									</div>
								</div>
								<div id="center-hide" style="z-index: 300;">
									<div id="speed"><div id="value">0</div> <div>MPH</div></div>
								</div>
							</div>
						</div>
					</div>
				</div>

                <!-- Throttle and brake Graphic -->
                <div id="bar_zone">
                    <h1 id="throttle_label" style="font-family:Seven Segment; color:#acadad; font-size: 24px;" >Throttle:</h1>
                    <h1 id="brake_label" style="font-family: Seven Segment; color:#acadad; font-size: 24px;">Brake:</h1>
                    <div id="throttle_bar"></div>
                    <div id="brake_bar"></div>
                </div>

				<!-- Position Graphic -->
				<div id="position_graphic" >
					<!-- Position Graphic will go here when implemented -->
					<p style="font-family:Seven Segment; color:#acadad; font-size: 18px;">*position graphic*</p>
				</div>

				<!-- Steering Graphic -->
				<div id="steering_graphic" >
					<!-- Steering Graphic will go here when implemented -->
					<p style="font-family:Seven Segment; color:#acadad; font-size: 18px;">*steering graphic*</p>
				</div>

				<!-- Remaining Sensor data Graphic -->
				<div id="misc_graphic" >
					<!-- Remaining Sensor data will go here when implemented -->
					<p style="font-family:Seven Segment; color:#acadad; font-size: 18px;">*other sensors*</p>
				</div>

			</div>


            <!-- Bottom Bar -->
			<div id="bottom_bar">
				<div class="icon"><img src="static/icons/car-oil.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/accident.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/battery.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/brake.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/engine.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/sensor.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/temp.png" height="100%" width="100%"></div>
				<div class="icon"><img src="static/icons/warning.png" height="100%" width="100%"></div>
				<div id="con_png" class="icon"><img id="connection_png" src="static/icons/radio.png" height="100%" width="100%"></div>
			</div>

		</div>
    </body>
</html>

<script type="text/javascript">
function resize (container1, container2) {
		const con1 = document.getElementById(container1);
		const con2 = document.getElementById(container2);
		const con1Width = con1.offsetWidth;
		
		con1.style.height = con1Width * 0.72 + "px"
		con2.style.height = con1Width * 0.72 + "px"
	}

function initalizeSpeedometer(numScales, container1, container2) {

	resize('speedometer-container-1', 'speedometer-container-2')

	element = document.getElementById('scales-container')
	htmlString = ""
	for (i=0; i < numScales; i++) {
		htmlString = htmlString + "<div class='scales scale-" + i + "' style='transform: rotate(" +((-180+(180/numScales))*i)+ "deg);'></div>"
	}

	element.innerHTML = htmlString
}

initalizeSpeedometer(10, 'speedometer-container-1', 'speedometer-container-2')

function handleResize() {
  // Code to execute on window resize
  console.log("Window resized!"); 
}

window.addEventListener("resize", function(){resize('speedometer-container-1', 'speedometer-container-2')});
</script>

<script>
	setInterval(async () => {
		const response = await fetch("/data");
		const data = await response.json();
		const maxSpeed = 40;
		document.getElementById("value").innerHTML = data.speed;
		document.getElementById("arrow-wrapper").style.transform = "rotate("+ (((data.speed/maxSpeed)*230)-25) + "deg)";
		document.getElementById("battery_percent_and_temp").innerText = data.battery_percent_and_temp;
		document.getElementById("battery_img").src = data.battery_img;
		document.getElementById("connection_png").src = data.con_png;
		document.getElementById("throttle_bar").style.width = data.throttle + "vw";
		document.getElementById("brake_bar").style.width = data.brake + "vw";
	}, 50);
</script>
